<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Heisig Character Decomposition</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: #f0f0f0;
  display: flex;
  justify-content: center;
  padding: 2rem 1rem;
  min-height: 100vh;
}
.container { max-width: 520px; width: 100%; }
h1 { text-align: center; margin-bottom: 1.5rem; font-size: 1.5rem; }
.input-row {
  display: flex; gap: 0.5rem; margin-bottom: 1rem;
}
.input-row input {
  flex: 1; font-size: 1.5rem; padding: 0.5rem 0.75rem;
  border: 2px solid #ccc; border-radius: 8px; text-align: center;
}
.card {
  background: #fff; border-radius: 12px; padding: 1.5rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1); display: none;
}
.card.visible { display: block; }
.char-display {
  font-size: 5rem; text-align: center; line-height: 1.2;
  margin-bottom: 0.25rem;
}
.keyword {
  text-align: center; font-size: 1.5rem; font-weight: 600;
  margin-bottom: 0.75rem;
}
.book-nums { text-align: center; color: #888; font-size: 0.85rem; margin-bottom: 1rem; }
.divider { border: none; border-top: 1px solid #eee; margin: 1rem 0; }
.component { font-size: 1.1rem; color: #444; margin: 0.4rem 0; }
.component .char { font-size: 1.2rem; margin-right: 0.5rem; }
.layout { color: #888; font-style: italic; margin-top: 0.75rem; font-size: 0.95rem; }
.not-found { text-align: center; color: #888; padding: 2rem 0; }
</style>
</head>
<body>
<div class="container">
  <h1>Heisig Character Decomposition</h1>
  <div class="input-row">
    <input type="text" id="charInput" placeholder="Enter a character (e.g. 学, 森, 休)" maxlength="4">
  </div>
  <div class="card" id="card">
    <div class="char-display" id="charDisplay"></div>
    <div class="keyword" id="keyword"></div>
    <div class="book-nums" id="bookNums"></div>
    <hr class="divider">
    <div id="components"></div>
    <div class="layout" id="layout"></div>
  </div>
  <div class="card not-found" id="notFound">Character not found in Heisig data.</div>
</div>

<script>
const IDS_DESC = {
  "⿰": "left → right", "⿱": "top → bottom", "⿲": "left → middle → right",
  "⿳": "top → middle → bottom", "⿴": "surrounded", "⿵": "open at bottom",
  "⿶": "open at top", "⿷": "open at right", "⿸": "upper-left wraps",
  "⿹": "upper-right wraps", "⿺": "lower-left wraps", "⿻": "overlapping",
};

let heisigData = null;

fetch('heisig_data.json')
  .then(r => r.json())
  .then(d => { heisigData = d; })
  .catch(() => alert('Failed to load heisig_data.json'));

const charInput = document.getElementById('charInput');
charInput.addEventListener('input', decompose);
charInput.addEventListener('keydown', e => { if (e.key === 'Enter') decompose(); });

function decompose() {
  const input = charInput.value.trim();
  if (!input || !heisigData) return;
  const char = [...input][0];
  const info = heisigData[char];
  const card = document.getElementById('card');
  const nf = document.getElementById('notFound');

  if (!info) {
    card.classList.remove('visible');
    nf.classList.add('visible');
    return;
  }

  nf.classList.remove('visible');
  card.classList.add('visible');

  document.getElementById('charDisplay').textContent = char;
  document.getElementById('keyword').textContent = info.keyword || '';

  const nums = [];
  if (info.RSH_number) nums.push('RSH #' + info.RSH_number);
  if (info.RTH_number) nums.push('RTH #' + info.RTH_number);
  if (info.RTK_number) nums.push('RTK #' + info.RTK_number);
  document.getElementById('bookNums').textContent = nums.join(' · ') || '';

  // Components
  const compEl = document.getElementById('components');
  compEl.innerHTML = '';
  const compStr = info.components_detail || '';
  if (compStr) {
    const seen = new Set();
    compStr.split(', ').forEach(part => {
      if (part.includes(' = ')) {
        const [c, k] = part.split(' = ');
        const key = c.trim() + '|' + k.trim();
        if (!seen.has(key)) {
          seen.add(key);
          const div = document.createElement('div');
          div.className = 'component';
          div.innerHTML = '<span class="char">' + escapeHtml(c.trim()) + '</span>' + escapeHtml(k.trim());
          compEl.appendChild(div);
        }
      }
    });
  }

  // Layout from IDS
  const layoutEl = document.getElementById('layout');
  const ids = info.ids || '';
  let layoutText = '';
  for (const c of ids) {
    if (IDS_DESC[c]) { layoutText = '(' + IDS_DESC[c] + ')'; break; }
  }
  if (!compStr) layoutText = '(no breakdown)';
  layoutEl.textContent = layoutText;
}

function escapeHtml(s) {
  const d = document.createElement('div');
  d.textContent = s;
  return d.innerHTML;
}
</script>
</body>
</html>
